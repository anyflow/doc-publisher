<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown-light.min.css"
    integrity="sha512-bm684OXnsiNuQSyrxuuwo4PHqr3OzxPpXyhT66DA/fhl73e1JmBxRKGnO/nRwWvOZxJLRCmNH7FII+Yn1JNPmg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
    .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 auto;
        padding: 45px;
    }

    @media (max-width: 767px) {
        .markdown-body {
            padding: 15px;
        }
    }
</style>
<article class="markdown-body"><h1><a id="user-content-manifest-작성-및-사용-가이드" class="anchor" aria-hidden="true" href="#manifest-작성-및-사용-가이드"><span aria-hidden="true" class="octicon octicon-link"></span></a>manifest 작성 및 사용 가이드</h1>
<h2><a id="user-content-기본-규칙" class="anchor" aria-hidden="true" href="#기본-규칙"><span aria-hidden="true" class="octicon octicon-link"></span></a>기본 규칙</h2>
<ul>
<li>directory 명으로 backend 구분</li>
<li>
<code>base.openapi.yaml</code> : environment 공통의 속성 정의 (파일명 변경 불가)</li>
<li>
<code>{environment}.openapi.yaml</code> : 해당 environment 별 속성 정의</li>
<li>
<code>apigw</code> directory에 포함된 environment 이외의 environment 정의는 무시됨</li>
<li>
<code>base.openapi.yaml</code> 가 따르는 규격
<ul>
<li>OpenAPI 3.0.3</li>
<li>TCN (<em><strong><code>base.openapi.yaml</code>의 TCN 규격 설명</strong></em> 섹션 참조)</li>
<li>krakend 최신 규격 (<code>apigw</code> 및 root에 위치한 <code>x-krakend</code> 항목의 경우)</li>
</ul>
</li>
</ul>
<h2><a id="user-content-manifest-directory-구조" class="anchor" aria-hidden="true" href="#manifest-directory-구조"><span aria-hidden="true" class="octicon octicon-link"></span></a>manifest directory 구조</h2>
<div class="highlight highlight-source-shell"><pre>manifest
├── apigw                     <span class="pl-c"><span class="pl-c">#</span> backend 공통 사항 정의 영역. (필수)</span>
│   ├── base.openapi.yaml     <span class="pl-c"><span class="pl-c">#</span> backend 공통 사항 정의 파일. (필수)</span>
│   ├── local.openapi.yaml    <span class="pl-c"><span class="pl-c">#</span> local environment overlay 파일</span>
│   └── prod.oepnapi.yam      <span class="pl-c"><span class="pl-c">#</span> prod environment overlay 파일</span>
└── backend_1                 <span class="pl-c"><span class="pl-c">#</span> backend 별 사항 정의 영역. backend_1은 해당 backend의 keyword.</span>
    ├── base.openapi.yaml     <span class="pl-c"><span class="pl-c">#</span> base (extended) openapi 파일</span>
    ├── local.openapi.yaml    <span class="pl-c"><span class="pl-c">#</span> local environment overlay 파일</span>
    └── prod.oepnapi.yaml     <span class="pl-c"><span class="pl-c">#</span> prod environment overlay 파일</span></pre></div>
<h2><a id="user-content-baseopenapiyaml의-tcn-규격-설명--global-영역" class="anchor" aria-hidden="true" href="#baseopenapiyaml의-tcn-규격-설명--global-영역"><span aria-hidden="true" class="octicon octicon-link"></span></a>
<code>base.openapi.yaml</code>의 TCN 규격 설명 : global 영역</h2>
<blockquote>
<p>각 항목에 대한 설명은 주석 참조. 주석 맨 앞에 '필수'가 있을 경우 해당 항목은 반드시 있어야 TCN 규격에 유효.</p>
</blockquote>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">x-tcn</span>: <span class="pl-c"><span class="pl-c">#</span> 필수. TCN 규격임을 나타냄</span>
  <span class="pl-ent">app</span>: <span class="pl-s">dockebi </span><span class="pl-c"><span class="pl-c">#</span> 필수. not null. backend를 나타내는 단일 word. 해당 파일이 포함된 directory 명과 동일해야 함.</span>
  <span class="pl-ent">contacts</span>: <span class="pl-c"><span class="pl-c">#</span> 필수. not null. openapi.info.contact의 첫 번째 아이템으로 사용됨</span>
    - <span class="pl-ent">name</span>: <span class="pl-s">박연진 </span><span class="pl-c"><span class="pl-c">#</span> 필수. not null.</span>
      <span class="pl-ent">email</span>: <span class="pl-s">fake_yeonjin.park@lge.com </span><span class="pl-c"><span class="pl-c">#</span> 필수. not null.</span>
  <span class="pl-ent">openapiEndpoint</span>: <span class="pl-c"><span class="pl-c">#</span> 필수. not null. 본 파일에 기술되는 모든 openapi endpoint 설정에 반영되는 사항 모음</span>
    <span class="pl-ent">urlPrefix</span>: <span class="pl-s">/dockebi </span><span class="pl-c"><span class="pl-c">#</span> 필수. not null. 모든 openapi path 값 앞에 붙는 prefix</span>
    <span class="pl-ent">parameters</span>: <span class="pl-c"><span class="pl-c">#</span> openapi의 path.{method}.parameters 참조</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">X-Dockebi-Region</span>
        <span class="pl-ent">in</span>: <span class="pl-s">header</span>
        <span class="pl-ent">schema</span>:
          <span class="pl-ent">type</span>: <span class="pl-s">string</span>
          <span class="pl-ent">example</span>: <span class="pl-s">f8f78c93-aec7-4d26-a3ab-cb263ddd08b1</span>
  <span class="pl-ent">krakendEndpoint</span>: <span class="pl-c"><span class="pl-c">#</span> 필수. not null. 모든 krakend endpoint configuration에 반영되는 사항 모음</span>
    <span class="pl-c"><span class="pl-c">#</span> output_encoding: json # 기본값은 no-op. endpoints.output_encoding에 해당</span>
    <span class="pl-ent">backend</span>:
      <span class="pl-ent">host</span>: <span class="pl-s">dockebi.cluster.svc.cluster.local:8080 </span><span class="pl-c"><span class="pl-c">#</span> 필수. not null. krakend configuartion의 backend.host 항목에 사용됨</span>
      <span class="pl-ent">virtualhost</span>: <span class="pl-s">local.dockebi.com </span><span class="pl-c"><span class="pl-c">#</span> 상기 host 이외의 host 및 해당 endpoint를 정의할 때 사용. krakend의 virtualhost 기능에 해당</span>
      <span class="pl-ent">urlPatternPrefix</span>: <span class="pl-s"><span class="pl-pds">"</span>/some_prefix<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> 기본값은 "". url_pattern 기본값 앞에 붙는 prefix. url_pattern 기본값에는 openapi의 path 값이 사용됨.</span>
      <span class="pl-ent">encoding</span>: <span class="pl-s">json </span><span class="pl-c"><span class="pl-c">#</span> 기본 값은 no-op. backend.encoding 값에 해당</span>
    <span class="pl-ent">extra_config</span>: <span class="pl-c"><span class="pl-c">#</span> krakend의 endpoints.backend.extra_config 참조.</span>
      <span class="pl-ent">auth/api-keys</span>:
        <span class="pl-ent">client_max_rate</span>: <span class="pl-c1">5</span>
        <span class="pl-ent">roles</span>:
          - <span class="pl-s">dockebi</span>
  <span class="pl-ent">global</span>: <span class="pl-c"><span class="pl-c">#</span> apigw backend 경우에만 유효 및 필수. 모든 backend의 endpoint에 적용되는 사항 모음.</span>
    <span class="pl-ent">krakendIgnorePaths</span>: <span class="pl-c"><span class="pl-c">#</span> 필수. not null. openapi에 정의되어 있음에도 krakend configuration에 반영되지 않는 항목 목록</span>
      - <span class="pl-s">/__echo/{dummy}</span>
    <span class="pl-ent">openapiEndpoint</span>: <span class="pl-c"><span class="pl-c">#</span> 필수. not null. x-tcn.openapiEndpoint와 동일하나 모든 backend에 적용됨</span>
      <span class="pl-ent">security</span>:
        - <span class="pl-ent">apiKeyAuth</span>: <span class="pl-s">[]</span>
      <span class="pl-c"><span class="pl-c">#</span> parameters:</span>
      <span class="pl-c"><span class="pl-c">#</span>   - name: X-Trace-Id</span>
      <span class="pl-c"><span class="pl-c">#</span>     in: header</span>
      <span class="pl-c"><span class="pl-c">#</span>     schema:</span>
      <span class="pl-c"><span class="pl-c">#</span>       type: string</span>
      <span class="pl-c"><span class="pl-c">#</span>       example: "f8f78c93-aec7-4d26-a3ab-cb263ddd08b1"</span>
    <span class="pl-ent">openapiComponents</span>: <span class="pl-c"><span class="pl-c">#</span> 필수. not null. 생성되는 모든 openapi.yaml에 적용되는 openapi의 components</span>
      <span class="pl-ent">securitySchemes</span>:
        <span class="pl-ent">apiKeyAuth</span>:
          <span class="pl-ent">type</span>: <span class="pl-s">apiKey</span>
          <span class="pl-ent">name</span>: <span class="pl-s">X-Api-Key</span>
          <span class="pl-ent">in</span>: <span class="pl-s">header</span>
    <span class="pl-ent">krakendEndpoint</span>: <span class="pl-c"><span class="pl-c">#</span> 필수. not null. x-tcn.krakendEndpoint와 동일하나 모든 backend에 적용됨</span>
      <span class="pl-ent">input_headers</span>:
        - <span class="pl-s">Content-Type</span>
        - <span class="pl-s">X-Api-Key</span>
      <span class="pl-ent">extra_config</span>:
        <span class="pl-ent">auth/api-keys</span>:
          <span class="pl-ent">roles</span>:
            - <span class="pl-s">admin</span>


<span class="pl-ent">x-krakend</span>: <span class="pl-c"><span class="pl-c">#</span> apigw backend 경우에만 유효 및 필수.</span>
...

<span class="pl-ent">openapi</span>: <span class="pl-s">3.0.3 </span><span class="pl-c"><span class="pl-c">#</span> 필수. version은 3.0.3으로 고정</span>
<span class="pl-ent">info</span>:
  <span class="pl-ent">title</span>: <span class="pl-s">Dockebi service </span><span class="pl-c"><span class="pl-c">#</span> 필수. 연동규격에 보여질 서비스명</span>
  <span class="pl-ent">description</span>: <span class="pl-s">|</span>
<span class="pl-s">    A service for TCN API Gateway testing   # 필수. 연동규격에 보여질 서비스 설명</span>
<span class="pl-s"></span><span class="pl-ent">paths</span>: <span class="pl-s">{} </span><span class="pl-c"><span class="pl-c">#</span> 필수. OpenAPI 규격의 필수 입력 field로서, 없을 경우 {}를 사용</span>
...</pre></div>
<h2><a id="user-content-baseopenapiyaml의-tcn-규격-설명--endpoint별-설명" class="anchor" aria-hidden="true" href="#baseopenapiyaml의-tcn-규격-설명--endpoint별-설명"><span aria-hidden="true" class="octicon octicon-link"></span></a>
<code>base.openapi.yaml</code>의 TCN 규격 설명 : endpoint별 설명</h2>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">paths</span>:
  <span class="pl-ent">/v1/stuff</span>:
    <span class="pl-ent">get</span>:
      <span class="pl-ent">summary</span>: <span class="pl-s">List all stuffs or search stuffs by name</span>
      <span class="pl-s">...</span>
      <span class="pl-ent">x-tcn</span>: <span class="pl-c"><span class="pl-c">#</span> TCN 규격</span>
        <span class="pl-ent">additionalPath</span>: <span class="pl-s">/addtional/some/path </span><span class="pl-c"><span class="pl-c">#</span> 지정된 endpoint에 대한 추가 주소.</span>
        <span class="pl-ent">virtualhostPath</span>: <span class="pl-s">/legacy/stuff </span><span class="pl-c"><span class="pl-c">#</span> 지정된 endpoint에 대한 virtualhost 상의 path. 본 값 지정 시 global 영역의 x-tcn.krakendEndpoint.backend.virtualhost가 반드시 정의되어 있어야 함.</span>
      <span class="pl-ent">x-krakend</span>: <span class="pl-c"><span class="pl-c">#</span> Krakend 규격(TCN 규격 확장). 본 항목에서 정의되는 속성은 자동 생성되는 속성을 override함.</span>
        <span class="pl-ent">input_headers</span>: <span class="pl-s">["*"] </span><span class="pl-c"><span class="pl-c">#</span> 수신할 request header 목록. *은 전체 header를 수신함을 의미</span>
        <span class="pl-ent">extra_config</span>:
          <span class="pl-s"><span class="pl-pds">"</span><span class="pl-ent">@test_extra_config</span><span class="pl-pds">"</span></span>: <span class="pl-s">extra_config_in_endpoint</span>
          <span class="pl-ent">auth/api-keys</span>:
            <span class="pl-ent">roles</span>:
              - <span class="pl-s">testRole </span><span class="pl-c"><span class="pl-c">#</span> 호출 가능한 role 추가 시 사용 (API KEY에 role이 정의됨)</span>
            <span class="pl-ent">client_max_rate</span>: <span class="pl-c1">10</span> <span class="pl-c"><span class="pl-c">#</span> API KEY 별 second당 호출 가능 횟수 지정</span></pre></div>

</article>